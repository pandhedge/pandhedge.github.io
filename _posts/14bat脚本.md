---
layout: post
title:  "BAT脚本"
date:   2025-08-28 20:18:00 +0800
categories: 软件测试
tags: 软件测试 python  
author: PandHedge
mathjax: true
---
# BAT脚本完全学习指南

BAT脚本（批处理脚本）是Windows系统下的一种**文本格式脚本文件**，通过批量执行DOS命令实现自动化操作，后缀为 `.bat` 或 `.cmd`（两者功能基本一致，.cmd兼容性更强）。它无需编译，直接由Windows命令解释器（`cmd.exe`）执行，常用于自动备份、批量文件操作、软件启动等场景。


## 一、基础操作：创建与执行

先掌握最核心的“怎么用”，再深入语法细节。

| 操作类型       | 具体步骤                                                                 | 说明                                                                 |
|----------------|--------------------------------------------------------------------------|----------------------------------------------------------------------|
| 创建BAT文件    | 1. 新建记事本（右键→新建→文本文档）<br>2. 输入代码后，按`Ctrl+S`保存<br>3. 文件名改为`xxx.bat`（如`test.bat`），保存类型选“所有文件” | 必须改后缀为`.bat`，否则会是`.txt`文本文件，无法执行                 |
| 执行BAT文件    | 方式1：双击`test.bat`文件直接运行<br>方式2：打开`cmd.exe`，输入`cd 脚本所在路径`，再输入`test.bat` | 方式2可查看执行过程中的错误信息；若需管理员权限，右键“以管理员身份运行” |
| 停止执行       | 执行时按 `Ctrl+C`，在cmd中输入`Y`确认停止                                 | 用于脚本陷入死循环或执行错误时紧急终止                               |


## 二、核心语法详解（表格版）

语法是脚本的核心，以下表格按“语法分类→具体用法→单行代码→详细解释”组织，方便对比学习。

### 1. 注释：说明代码用途（不执行）

注释是脚本可读性的关键，BAT支持两种注释方式。

| 语法分类 | 语法点 | 单行代码示例                | 解释                                                                 |
|----------|--------|-----------------------------|----------------------------------------------------------------------|
| 注释     | `rem`  | `rem 这是一条注释，会显示在echo on模式下` | 全称“remark”，兼容性好，但执行时若开启`echo on`（显示命令），会打印注释内容 |
| 注释     | `::`   | `:: 这是一条注释，不显示在执行过程中`   | 本质是“空标签”的变种，注释效率更高，执行时不会显示，推荐优先使用       |


### 2. 变量：存储数据（类似容器）

BAT变量分**系统变量**（Windows自带）和**自定义变量**（用户创建），变量引用需用 `%变量名%`（延迟变量用 `!变量名!`）。

| 语法分类 | 语法点         | 单行代码示例                          | 解释                                                                 |
|----------|----------------|---------------------------------------|----------------------------------------------------------------------|
| 系统变量 | 自带变量       | `echo 当前系统目录：%SystemRoot%`     | 系统变量是Windows预定义的，常用：<br>`%SystemRoot%`（C:\Windows）、`%USERNAME%`（当前用户名）、`%DATE%`（当前日期） |
| 自定义变量 | `set 变量名=值` | `set name=张三 & echo 我的名字：%name%` | 1. 等号**两边不能有空格**（如`set name= 张三`会多空格）<br>2. `&`用于连接两个命令，一行执行 |
| 延迟变量   | `enabledelayedexpansion` | `setlocal enabledelayedexpansion & for /l %%i in (1,1,3) do (set num=%%i & echo !num!)` | 解决“循环中变量不更新”问题：<br>默认情况下变量在脚本开始时解析，循环中改值也无效；开启延迟扩展后，用`!变量名!`实时读取变量值，上述代码会输出1、2、3 |


### 3. 流程控制：控制代码执行顺序

包括“判断（if）”“循环（for）”“跳转（goto）”，是脚本逻辑的核心。

| 语法分类 | 语法点               | 单行代码示例                                  | 解释                                                                 |
|----------|----------------------|-----------------------------------------------|----------------------------------------------------------------------|
| if判断   | 判断文件是否存在     | `if exist test.txt (echo 文件存在) else (echo 文件不存在)` | `exist` 是“存在”关键字，判断`test.txt`是否存在，执行对应分支         |
| if判断   | 判断变量是否相等     | `set age=18 & if %age% equ 18 (echo 成年) else (echo 未成年)` | 数值比较用 `equ`（等于）、`neq`（不等于）、`gtr`（大于）；字符串比较直接用`==` |
| for循环  | 数字循环（/l）       | `for /l %%i in (1,1,5) do (echo 第%%i次循环)`   | `/l` 表示“数字序列”，格式：`%%变量 in (起始值,步长,结束值)`，上述代码输出1-5的循环次数 |
| for循环  | 读取文件行（/f）     | `for /f "delims=" %%i in (test.txt) do (echo 行内容：%%i)` | `/f` 用于读取文件/命令输出，`delims=` 表示“不分割行”（默认按空格分割），逐行读取`test.txt`内容并输出 |
| for循环  | 遍历文件夹文件（/r） | `for /r C:\test %%i in (*.txt) do (echo TXT文件：%%i)` | `/r` 表示“递归遍历”，遍历`C:\test`及子文件夹下所有`.txt`文件，输出文件路径 |
| goto跳转  | `:标签` + `goto 标签` | `:start & echo 循环中... & timeout /t 1 /nobreak >nul & goto start` | 1. `:start` 是“标签”（冒号开头）<br>2. `goto start` 跳转到`start`标签，实现无限循环<br>3. `timeout /t 1` 延迟1秒，`>nul` 隐藏输出 |


## 三、常用命令速查（表格版）

BAT脚本本质是“命令的集合”，以下是最常用的DOS命令，覆盖文件操作、系统操作等场景。

| 命令名称 | 功能描述                 | 单行代码示例                          | 解释                                                                 |
|----------|--------------------------|---------------------------------------|----------------------------------------------------------------------|
| `echo`   | 输出文本/控制命令回显     | `echo off & echo 只显示这行内容`      | 1. `echo 文本`：输出文本<br>2. `echo off`：关闭“命令回显”（默认会显示执行的命令，关闭后只显示`echo`的内容）<br>3. `@echo off`：`@`让`echo off`本身也不显示 |
| `dir`    | 列出文件夹内容           | `dir C:\test /a /p`                   | 常用参数：<br>`/a`（显示所有文件，包括隐藏文件）、`/p`（分页显示，避免内容刷屏） |
| `cd`     | 切换目录                 | `cd /d D:\work`                       | 1. `cd 目录路径`：切换当前目录<br>2. `/d` 用于跨盘符切换（如从C盘到D盘必须加`/d`） |
| `copy`   | 复制文件                 | `copy C:\test\a.txt D:\backup\`       | 1. 格式：`copy 源文件路径 目标路径`<br>2. 若目标路径不存在，会提示“是否创建目录” |
| `del`    | 删除文件                 | `del C:\test\*.txt /f /q`             | 常用参数：<br>`*.txt`（删除所有TXT文件）、`/f`（强制删除只读文件）、`/q`（安静模式，不提示确认） |
| `md`/`mkdir` | 创建文件夹           | `md C:\test\backup`                   | `md`和`mkdir`功能一致，创建多级目录（如`md a\b\c`）会自动创建父目录 |
| `rd`/`rmdir` | 删除文件夹           | `rd C:\test\backup /s /q`             | 必须加参数：<br>`/s`（删除文件夹及所有子文件/子目录）、`/q`（不提示确认）；空文件夹可直接`rd 路径` |
| `taskkill` | 结束进程             | `taskkill /f /im notepad.exe`         | 1. `/f`（强制结束）、`/im`（按进程名匹配）<br>2. 上述代码强制关闭所有记事本（notepad.exe） |
| `ping`   | 测试网络连接             | `ping baidu.com -n 3 >nul`            | 1. `ping 目标IP/域名`：测试网络连通性<br>2. `-n 3`：发送3个数据包（默认4个）、`>nul`隐藏输出 |
| `timeout` | 延迟执行                 | `timeout /t 5 /nobreak`               | `/t 5`：延迟5秒，`/nobreak`：按任意键不跳过延迟（默认按任意键可跳过） |


## 四、进阶技巧：提升脚本实用性

| 技巧点               | 单行代码示例                                  | 解释                                                                 |
|----------------------|-----------------------------------------------|----------------------------------------------------------------------|
| 批处理参数（%1-%9）  | `echo 第一个参数：%1 & echo 第二个参数：%2`    | 运行脚本时可传参数，如`test.bat 苹果 香蕉`，脚本中`%1`是“苹果”，`%2`是“香蕉”，最多支持9个参数 |
| 错误处理（%errorlevel%） | `copy a.txt b.txt & if %errorlevel% equ 0 (echo 复制成功) else (echo 复制失败)` | `%errorlevel%`是“命令返回码”：<br>0=执行成功，非0=执行失败（如复制文件不存在时返回1），用于判断命令是否执行成功 |
| 重定向输出（> / >>） | `dir C:\test\*.txt > filelist.txt`            | 1. `>`：覆盖文件（若`filelist.txt`存在，会清空后写入）<br>2. `>>`：追加文件（在`filelist.txt`末尾添加内容） |
| 管道（\|）            | `ping baidu.com -n 1 | find "TTL"`            | `|` 把前一个命令的输出作为后一个命令的输入：<br>上述代码“ping百度”后，用`find`筛选包含“TTL”的行（TTL存在表示网络连通） |
| 调用其他批处理       | `call other.bat`                              | `call` 用于调用另一个BAT脚本（如`other.bat`），执行完后返回当前脚本继续执行；若不用`call`，调用后会直接退出当前脚本 |


## 五、实战案例：从理论到实践

以下案例包含完整代码和逐行解释，直接复制到记事本改后缀为`.bat`即可运行。


### 案例1：自动备份文件（每天备份一次）
```bat
@echo off  # 关闭命令回显，只显示关键内容
setlocal enabledelayedexpansion  # 开启延迟变量

:: 1. 定义备份参数
set source=C:\Users\%USERNAME%\Desktop  # 备份源目录（当前用户桌面）
set backup=D:\Desktop_Backup  # 备份目标目录
set date=%date:~0,4%%date:~5,2%%date:~8,2%  # 格式化日期为“YYYYMMDD”（如20240520）
set backup_dir=!backup!\!date!  # 备份文件夹（如D:\Desktop_Backup\20240520）

:: 2. 检查目标目录是否存在，不存在则创建
if not exist !backup_dir! (md !backup_dir!)

:: 3. 执行备份（复制源目录所有文件到目标目录）
xcopy !source!\* !backup_dir!\ /s /e /y  # /s复制子目录，/e复制空目录，/y覆盖不提示

:: 4. 提示备份结果
if %errorlevel% equ 0 (
    echo 备份成功！备份路径：!backup_dir!
) else (
    echo 备份失败，请检查路径是否正确！
)

timeout /t 5  # 延迟5秒，让用户看到结果
exit  # 退出脚本
```


### 案例2：批量重命名文件（所有TXT文件加前缀“文档_”）
```bat
@echo off
setlocal enabledelayedexpansion

:: 切换到目标目录（替换为你的TXT文件所在目录）
cd /d D:\test

:: 遍历目录下所有TXT文件，批量重命名
for /f "delims=" %%i in ('dir /b *.txt') do (
    set old_name=%%i  # 获取原文件名（如“笔记.txt”）
    set new_name=文档_!old_name!  # 拼接新文件名（如“文档_笔记.txt”）
    ren "!old_name!" "!new_name!"  # 执行重命名（ren=rename）
    echo 已重命名：!old_name! → !new_name!
)

echo 批量重命名完成！
timeout /t 3
exit
```


## 六、注意事项（避坑指南）
1. **路径空格问题**：若路径包含空格（如`C:\My Documents`），必须加双引号，否则会被解析为多个参数，例：`cd /d "C:\My Documents"`。
2. **变量空格问题**：`set 变量名=值` 中等号两边不能有空格，如`set name= 张三`会导致变量值多一个空格，后续使用时会出错。
3. **权限问题**：操作系统目录（如C:\Windows）或系统文件时，需右键“以管理员身份运行”脚本，否则会提示“权限不足”。
4. **循环变量问题**：`for`循环中使用的变量必须用**两个百分号**（`%%i`），若直接在cmd中执行单条for命令，只用一个百分号（`%i`）。

通过以上内容，你可以掌握BAT脚本的核心用法，从简单的命令集合到复杂的逻辑控制。建议先从“修改实战案例”开始练习（如改备份路径、重命名前缀），逐步积累经验。


在BAT脚本（及Windows命令行）中，**管道（Pipe）** 是一个特殊符号 `|`，用于将**前一个命令的输出结果**直接作为**后一个命令的输入**，实现多个命令的“协作处理”。它的核心作用是“连接命令流”，让数据在多个命令间传递并逐步处理，大幅提升复杂任务的效率。


## 管道的工作原理
- 正常情况下，命令的输出会直接显示在屏幕上（标准输出，stdout）。
- 使用 `|` 后，前一个命令的输出会被“拦截”，并作为输入传递给后一个命令，而不是直接显示。
- 后一个命令需要能接收“标准输入”（即可以处理从管道传来的数据），常见的如 `find`、`sort`、`more`、`findstr` 等。


#### 常用场景与示例（表格版）
以下是管道在实际脚本中的典型用法，结合具体命令展示其作用：

| 应用场景             | 单行代码示例                              | 详细解释                                                     |
| -------------------- | ----------------------------------------- | ------------------------------------------------------------ |
| 筛选包含特定内容的行 | `dir C:\test | find "txt"`                | - `dir C:\test` 列出C:\test目录下的文件/文件夹（输出到屏幕）<br>- `|` 将前一步的输出传递给`find`命令<br>- `find "txt"` 从输入中筛选包含“txt”的行（如TXT文件），最终只显示含“txt”的结果 |
| 排除特定内容的行     | `ipconfig | find /v "以太网"`             | - `ipconfig` 显示网络配置信息<br>- `find /v "以太网"` 中的`/v`表示“排除包含指定字符串的行”<br>效果：只显示不包含“以太网”的网络配置内容 |
| 分页显示大量输出     | `dir C:\ /s | more`                       | - `dir C:\ /s` 递归列出C盘所有文件（内容极多，会刷屏）<br>- `| more` 将输出分页显示（按空格键翻页，按Q退出），避免信息一次性刷完无法查看 |
| 对输出结果排序       | `dir /b *.txt | sort`                     | - `dir /b *.txt` 以“ bare format”（仅文件名）列出所有TXT文件<br>- `| sort` 对文件名进行字母/数字排序，输出排序后的结果 |
| 统计符合条件的行数   | `type log.txt | find "ERROR" /c`          | - `type log.txt` 读取log.txt文件内容并输出<br>- `find "ERROR" /c` 中的`/c`表示“统计包含ERROR的行数”<br>效果：直接得到log.txt中错误信息的数量 |
| 复杂组合：多管道串联 | `dir /b C:\test | find ".docx" | sort /r` | 多管道可串联使用：<br>1. `dir /b C:\test` 输出C:\test下的所有文件名<br>2. `| find ".docx"` 筛选出DOCX文件<br>3. `| sort /r` 以“反向（倒序）”排序结果 |


#### 管道与重定向的区别
管道（`|`）和重定向（`>`/`>>`）都用于处理命令输出，但作用不同：
- **管道**：将输出传递给**另一个命令**（用于处理数据）。
- **重定向**：将输出传递给**文件**（用于保存数据）。

示例对比：
```bat
:: 管道：筛选后显示在屏幕
dir | find "txt"

:: 重定向：筛选后保存到文件
dir | find "txt" > txt_files.txt  # 先管道筛选，再重定向保存
```


#### 注意事项
1. 并非所有命令都支持管道输入：例如 `echo`、`md` 等命令不接收标准输入，无法作为管道的“接收方”。
2. 管道前后的命令优先级：管道会同时启动前后两个命令，前一个命令的输出产生后立即传递给后一个，无需等待前一个命令执行完。
3. 复杂命令需用引号：若管道前后的命令包含空格或特殊字符，需用双引号包裹，例如：`"C:\Program Files\tool.exe" | find "result"`。

通过管道，你可以将简单命令组合成“命令链”，完成复杂的文本处理、筛选、统计等任务，是BAT脚本进阶中提升效率的核心技巧之一。



# 常见核心指令


## 一、BAT脚本的常见用法场景（附示例）
这些场景覆盖日常办公、系统维护的高频需求，直接套用或修改即可使用。

| 用法场景                | 场景说明                                                                 | 简化示例代码                                                                 |
|-------------------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------|
| 自动文件备份            | 定期复制指定文件夹（如桌面、文档）到备份目录，避免文件丢失                 | ```bat @echo off <br> xcopy C:\Users\文档 D:\备份 /s /e /y <br> echo 备份完成！``` |
| 批量文件重命名          | 统一修改文件前缀/后缀（如给所有图片加“旅游_”前缀，或批量改扩展名）         | ```bat @echo off <br> for %%i in (*.jpg) do ren "%%i" "旅游_%%i"```          |
| 系统信息查询与导出      | 提取本机IP、硬件信息、进程列表等，保存到文件用于诊断                       | ```bat @echo off <br> ipconfig > C:\IP信息.txt <br> tasklist >> C:\进程列表.txt``` |
| 自动清理垃圾文件        | 删除临时文件夹、缓存文件（如Windows Temp目录、浏览器缓存）                 | ```bat @echo off <br> del /f /q C:\Windows\Temp\* <br> echo 清理完成！```    |
| 多命令批量执行          | 一次性执行多个关联命令（如启动软件、打开文件夹、执行程序）                 | ```bat @echo off <br> start D:\工作文档 <br> start notepad.exe <br> start chrome.exe``` |
| 条件判断执行任务        | 根据文件是否存在、时间是否符合等条件，决定是否执行操作（如定时任务）       | ```bat @echo off <br> if exist C:\flag.txt (echo 标记文件存在) else (md C:\备份)``` |


## 二、BAT脚本的常见核心指令（按功能分类）
这些指令是构建脚本的基础，掌握后可组合实现复杂逻辑。


### 1. 基础操作指令（控制输出、目录切换等）
| 指令       | 功能描述                                  | 常用参数                | 示例代码                          | 解释                                                                 |
|------------|-------------------------------------------|-------------------------|-----------------------------------|----------------------------------------------------------------------|
| `echo`     | 输出文本/控制命令回显                      | `on`/`off`（控制回显）  | `@echo off & echo 操作完成`       | - `@` 让当前命令不显示<br>- `echo off` 关闭后续命令的回显（只显示`echo`内容） |
| `cd`       | 切换当前目录                              | `/d`（跨盘符切换）      | `cd /d D:\工作文件夹`             | 不加`/d`无法从C盘直接切换到D盘，必须用`cd /d`                          |
| `dir`      | 列出目录中的文件/文件夹                    | `/b`（仅文件名）、`/s`（递归） | `dir *.txt /b /s`                 | 递归列出所有子目录中的TXT文件，仅显示文件名（无额外信息）               |
| `pause`    | 暂停脚本执行，等待用户按任意键继续        | 无                      | `echo 请检查文件，按任意键继续... & pause` | 常用于需要人工确认的步骤（如执行删除前暂停）                           |
| `exit`     | 退出当前命令行窗口或脚本                  | 无                      | `echo 操作结束，即将退出 & exit`   | 脚本执行完后自动关闭窗口，避免残留cmd窗口                             |


### 2. 文件/文件夹操作指令
| 指令       | 功能描述                                  | 常用参数                                  | 示例代码                                      | 解释                                                                 |
|------------|-------------------------------------------|-------------------------------------------|-----------------------------------------------|----------------------------------------------------------------------|
| `copy`     | 复制文件                                  | `/y`（覆盖不提示）、`/v`（验证复制）      | `copy C:\a.txt D:\备份\ /y`                   | 复制`a.txt`到D盘备份目录，覆盖已有文件不提示                           |
| `xcopy`    | 复制文件夹（含子目录）                    | `/s`（复制子目录，不含空目录）、`/e`（含空目录）、`/y`（覆盖） | `xcopy C:\照片 D:\照片备份 /s /e /y`          | 复制“照片”文件夹及所有子目录（包括空文件夹），覆盖不提示               |
| `del`      | 删除文件                                  | `/f`（强制删除只读文件）、`/q`（安静模式，不提示）、`*`（通配符） | `del D:\临时文件\*.tmp /f /q`                 | 强制删除“临时文件”目录下所有`.tmp`文件，不弹出确认提示                 |
| `md`/`mkdir` | 创建文件夹                            | 无（支持多级目录）                        | `md D:\新文件夹\子文件夹`                     | 一次性创建“新文件夹”和其下的“子文件夹”（父目录不存在时自动创建）       |
| `rd`/`rmdir` | 删除文件夹                            | `/s`（删除所有子内容）、`/q`（不提示）    | `rd D:\旧文件夹 /s /q`                        | 彻底删除“旧文件夹”及其所有子文件/子目录，不提示确认                   |
| `ren`/`rename` | 重命名文件/文件夹                  | 无                                        | `ren C:\1.txt 2.txt`                          | 将`1.txt`重命名为`2.txt`；也可重命名文件夹：`ren 旧文件夹 新文件夹`    |


### 3. 系统管理指令
| 指令         | 功能描述                                  | 常用参数                                  | 示例代码                                      | 解释                                                                 |
|--------------|-------------------------------------------|-------------------------------------------|-----------------------------------------------|----------------------------------------------------------------------|
| `tasklist`   | 列出正在运行的进程                        | `/fi`（筛选进程）                         | `tasklist /fi "imagename eq notepad.exe"`     | 筛选出所有“记事本（notepad.exe）”进程                                |
| `taskkill`   | 结束指定进程                              | `/f`（强制结束）、`/im`（按进程名）、`/pid`（按进程ID） | `taskkill /f /im notepad.exe`                 | 强制关闭所有记事本进程（`/im`后接进程名）                             |
| `ipconfig`   | 显示网络配置（IP地址、子网掩码等）        | `/all`（显示详细信息）                    | `ipconfig /all > C:\网络信息.txt`             | 输出详细网络信息并保存到文件（`>`为重定向）                           |
| `ping`       | 测试网络连通性                            | `-n 次数`（发送数据包数量）、`-t`（持续ping） | `ping baidu.com -n 3`                         | 向百度发送3个数据包，测试网络是否通畅                                 |
| `systeminfo` | 显示系统详细信息（操作系统、内存、CPU等） | 无                                        | `systeminfo | find "总物理内存"`              | 用管道筛选出“总物理内存”信息（只显示一行关键内容）                    |
| `shutdown`   | 关机/重启系统                             | `-s`（关机）、`-r`（重启）、`-t 秒数`（延迟时间） | `shutdown -s -t 300`                          | 5分钟（300秒）后自动关机；`-a`可取消：`shutdown -a`                   |


### 4. 流程控制指令（构建逻辑）
| 指令   | 功能描述                                  | 常用语法/参数                             | 示例代码                                      | 解释                                                                 |
|--------|-------------------------------------------|-------------------------------------------|-----------------------------------------------|----------------------------------------------------------------------|
| `if`   | 条件判断（文件存在、变量相等、命令结果等） | `exist`（文件存在）、`equ`（等于）、`%errorlevel%`（命令返回码） | `if exist C:\test.txt (echo 存在) else (echo 不存在)` | 判断`test.txt`是否存在，执行对应分支                                 |
| `for`  | 循环（遍历文件、数字、命令输出等）        | `/l`（数字循环）、`/f`（读取文件行）、`/r`（递归遍历文件） | `for /l %%i in (1,1,5) do echo 第%%i次`      | 数字循环：从1到5，步长1，依次输出“第1次”到“第5次”                    |
| `goto` | 跳转到标签位置（实现循环或分支）          | `:标签名`（定义标签）                     | `:loop <br> echo 循环中... <br> goto loop`    | 定义`loop`标签，用`goto loop`实现无限循环（按Ctrl+C停止）             |
| `call` | 调用其他BAT脚本（执行后返回当前脚本）     | 脚本路径                                  | `call D:\工具\备份脚本.bat`                    | 执行“备份脚本.bat”，完成后返回当前脚本继续执行（不加`call`会直接退出） |


## 三、实用技巧（避坑与效率提升）
1. **处理路径空格**：若路径包含空格（如`C:\My Documents`），必须用双引号包裹，否则会被解析为多个参数。  
   示例：`cd /d "C:\My Documents"`  

2. **变量延迟扩展**：循环中修改变量后，需用 `setlocal enabledelayedexpansion` 开启延迟扩展，并用 `!变量名!` 实时读取。  
   示例：  
   ```bat
   setlocal enabledelayedexpansion
   for /l %%i in (1,1,3) do (
       set num=%%i
       echo !num!  # 输出1、2、3（不用!会输出空）
   )
   ```

3. **错误处理**：用 `%errorlevel%` 判断命令是否执行成功（0=成功，非0=失败）。  
   示例：  
   ```bat
   copy a.txt b.txt
   if %errorlevel% equ 0 (echo 复制成功) else (echo 复制失败)
   ```

4. **参数传递**：运行脚本时可传入参数（`%1`到`%9`），灵活定制脚本行为。  
   示例：`test.bat 123 abc` 中，`%1=123`，`%2=abc`，脚本内可直接使用。


通过上述常见用法和指令，可覆盖80%以上的BAT脚本需求。实际使用时，建议从简单场景（如批量重命名）入手，逐步组合指令实现复杂逻辑（如带条件判断的自动备份）。



# 常见用法

BAT脚本的常见用法可分为**通用场景**（适用于个人电脑、工作站）和**服务器测试场景**（针对服务器运维、性能/稳定性测试），两者侧重点不同：通用场景更偏向本地文件/系统操作，而服务器测试场景更关注服务可用性、资源监控、网络连通性等。


## 一、BAT脚本的通用常见用法（适用于各类Windows环境）
这些用法聚焦于“自动化重复操作”，覆盖日常办公、系统维护的高频需求：

| 用法分类         | 典型场景                                                                 | 示例代码（简化版）                                                                 | 代码说明                                                                 |
|------------------|--------------------------------------------------------------------------|----------------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **文件批量处理** | 1. 批量重命名文件（统一前缀/后缀）<br>2. 按类型分类文件（如图片、文档分开存放） | ```bat @echo off <br> :: 批量给TXT文件加日期前缀 <br> set dt=%date:~0,4%%date:~5,2%%date:~8,2% <br> for %%i in (*.txt) do ren "%%i" "%dt%_%%i"``` | - `%date%` 获取当前日期，通过`~`截取格式化为`YYYYMMDD`<br>- `for`循环遍历所有TXT文件，用`ren`加前缀重命名 |
| **系统环境配置** | 1. 自动设置环境变量<br>2. 初始化工作目录（创建常用文件夹结构）             | ```bat @echo off <br> :: 创建多级工作目录 <br> md D:\Work\文档 D:\Work\图片 D:\Work\备份 <br> echo 目录创建完成！``` | `md`支持同时创建多个目录，无需逐行执行，适合新系统初始化                 |
| **多任务自动化** | 1. 一键启动多个程序（如办公软件、浏览器）<br>2. 执行完任务后自动关机       | ```bat @echo off <br> start notepad.exe <br> start winword.exe <br> start chrome.exe <br> echo 程序启动完成，5分钟后关机... <br> shutdown -s -t 300``` | - `start` 用于启动程序（不阻塞后续命令）<br>- `shutdown -s -t 300` 300秒后关机（`-a`可取消） |
| **日志与报告生成** | 1. 记录操作日志（如备份时间、结果）<br>2. 导出系统信息到报告文件           | ```bat @echo off <br> echo [%time%] 开始备份... >> backup.log <br> xcopy C:\Data D:\Backup /s /e /y <br> echo [%time%] 备份完成 >> backup.log``` | - `>>` 追加日志到`backup.log`（记录时间`%time%`）<br>- 便于追溯操作历史 |


## 二、BAT脚本在服务器测试中的常见用法
服务器测试更关注“服务可用性、性能稳定性、网络连通性、批量管理”，BAT脚本可通过组合命令快速完成重复性测试任务：

| 测试场景               | 核心目标                                                                 | 示例代码（实用版）                                                                 | 代码说明                                                                 |
|------------------------|--------------------------------------------------------------------------|----------------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **服务状态检查**       | 验证关键服务（如IIS、MySQL、FTP）是否正常运行                             | ```bat @echo off <br> :: 检查IIS服务（w3svc）状态 <br> sc query w3svc | find "RUNNING" <br> if %errorlevel% equ 0 (echo IIS服务正常) else (echo IIS服务停止)``` | - `sc query 服务名` 查看服务状态（`w3svc`是IIS服务名）<br>- `find "RUNNING"` 筛选“运行中”状态，通过`%errorlevel%`判断结果 |
| **端口连通性测试**     | 检查服务器端口（如80、443、3389）是否开放（用于验证防火墙、服务监听）     | ```bat @echo off <br> :: 测试80端口（HTTP）和3389端口（远程桌面） <br> for %%p in (80,3389) do ( <br>   telnet 127.0.0.1 %%p >nul 2>&1 <br>   if !errorlevel! equ 0 (echo 端口%%p：开放) else (echo 端口%%p：关闭) <br> )``` | - `telnet 地址 端口` 测试端口连通性（需开启telnet客户端）<br>- `>nul 2>&1` 隐藏错误输出，用延迟变量`!errorlevel!`判断结果 |
| **资源监控与记录**     | 定时记录服务器CPU、内存、磁盘使用率（用于性能瓶颈分析）                   | ```bat @echo off <br> setlocal enabledelayedexpansion <br> :loop <br> echo [%date% %time%] >> resource.log <br> systeminfo | find "处理器" >> resource.log <br> systeminfo | find "总物理内存" >> resource.log <br> wmic logicaldisk get size,freespace,caption >> resource.log <br> timeout /t 300 /nobreak >nul <br> goto loop``` | - `systeminfo` 提取CPU/内存信息，`wmic`获取磁盘空间<br>- 每5分钟（300秒）记录一次，形成资源变化趋势日志 |
| **日志错误筛选**       | 从服务器日志（如IIS日志、应用程序日志）中快速定位错误信息（如500错误）    | ```bat @echo off <br> :: 筛选IIS日志中的500错误（假设日志路径为C:\IISLog\*.log） <br> findstr /s /i "500" C:\IISLog\*.log > error_500.log <br> echo 错误日志已保存到error_500.log``` | - `findstr /s` 递归搜索所有日志文件<br>- `/i` 不区分大小写，筛选包含“500”（服务器内部错误）的行 |
| **批量服务器操作**     | 对多台服务器执行相同命令（如远程检查服务状态、推送配置文件）               | ```bat @echo off <br> :: 批量检查多台服务器的MySQL服务（需提前配置信任或使用psexec） <br> for %%s in (192.168.1.10,192.168.1.11,192.168.1.12) do ( <br>   echo 检查服务器%%s... <br>   psexec \\%%s sc query mysql <br> )``` | - 借助`psexec`（微软Sysinternals工具）实现远程命令执行<br>- 批量验证集群中所有节点的服务状态（需管理员权限） |
| **压力测试辅助**       | 模拟多进程并发（如批量启动程序），测试服务器负载能力                       | ```bat @echo off <br> :: 启动10个记事本进程（模拟轻量并发） <br> for /l %%i in (1,1,10) do ( <br>   start notepad.exe <br>   echo 已启动第%%i个进程 <br> ) <br> timeout /t 60 <br> taskkill /f /im notepad.exe >nul <br> echo 测试结束，进程已清理``` | - 用`for /l`循环启动10个进程，持续60秒后用`taskkill`关闭<br>- 配合资源监控工具（如任务管理器）观察CPU/内存负载 |


## 三、服务器测试脚本的关键特点
1. **自动化与定时性**：服务器测试常需定时执行（如每小时检查一次服务），可结合Windows“任务计划程序”触发BAT脚本。  
2. **错误处理**：脚本需包含`%errorlevel%`判断命令执行结果，并记录错误日志（便于事后排查）。  
3. **轻量化**：服务器环境通常不安装第三方工具，脚本优先使用Windows内置命令（`sc`、`wmic`、`telnet`、`findstr`等）。  
4. **权限适配**：服务器多为管理员权限运行，脚本中涉及系统目录、服务操作时需确保权限充足。


通过上述用法，BAT脚本可大幅减少服务器测试中的重复操作，尤其适合中小规模Windows服务器集群的日常巡检和简单压力测试。